# F-001 Issue取得 バックエンド設計書

## メタ情報
- **ドキュメントID**: DETAIL-ORCH-004-F001-BE-001
- **機能ID**: F-001
- **バージョン**: 1.0.0
- **ステータス**: ドラフト
- **作成日**: 2026-01-28
- **作成者**: Antigravity (AI Technical Writer)

---

## 1. 実装クラス設計

### 1.1 `GitHubIssueFetcher`
`IIssueFetcher` インターフェースを実装する具体的なクラス。`Bun.spawn` または既存の `exec` ユーティリティを使用して `gh` コマンドを呼び出す。

- **責務**:
  - `gh` CLIコマンドの構築と実行。
  - 標準出力からのJSON取得とパース。
  - プロセス終了コードに基づくエラー判定。

```typescript
// src/input/github.ts (v3.0.0での簡略化された配置例)
export class GitHubIssueFetcher implements IIssueFetcher {
  async fetch(issueNumber: number, options?: FetchOptions): Promise<IssueData> {
    // 処理の実装
  }
}
```

---

## 2. GitHub API連携詳細

本機能は直接GitHub REST APIを叩くのではなく、`gh` CLIをラッパーとして使用する。これにより、認証管理やレート制限のハンドリングを `gh` に委ねることができる。

### 2.1 使用する gh コマンド

```bash
gh issue view <issue-number> --json title,body,labels
```

### 2.2 出力フォーマット例
`gh` コマンドが返すJSON構造:

```json
{
  "title": "F-001 Issue取得の詳細設計書とバックエンド設計書を作成",
  "body": "## TASK: ...",
  "labels": [
    {
      "name": "orch:queued",
      "color": "C2E0C6",
      "description": "Waiting for execution"
    }
  ]
}
```

---

## 3. CLI (gh) コマンド詳細

### 3.1 実行パラメータ
- `issueNumber`: 取得対象のIssue番号。
- `repository` (オプション): `--repo <owner/repo>` 形式でターゲットリポジトリを指定可能。

### 3.2 実行環境の考慮事項
- **カレントリポジトリ**: `gh` はデフォルトでカレントディレクトリのgit設定からリポジトリを特定する。
- **認証**: 実行ユーザーが `gh auth login` 済みであるか、環境変数 `GITHUB_TOKEN` が設定されている必要がある。

---

## 4. データパース・マッピング

取得したJSONを内部の `IssueData` モデルに変換する際のロジック。

- **Labels**: `gh` の `labels` 配列を `IssueLabel` オブジェクトの配列に変換する。
- **Body**: Markdown形式のテキストをそのまま保持する。
- **Error Handling**: `stderr` に出力がある場合、または終了コードが非ゼロの場合は `GitHubCliError` をスローする。

---

## 5. 依存関係
- **Runtime**: Bun 1.0+
- **CLI**: GitHub CLI (gh)
- **Utilities**: `src/core/exec.ts` (プロセス実行用共通関数)
