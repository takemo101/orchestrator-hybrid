{
  "$ref": "#/definitions/OrchConfig",
  "definitions": {
    "OrchConfig": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string",
          "default": "1.0"
        },
        "backend": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "claude",
                "opencode",
                "gemini",
                "container"
              ],
              "default": "claude"
            },
            "model": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "container": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "image": {
              "type": "string",
              "default": "node:20"
            },
            "env_id": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "sandbox": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "docker",
                "container-use",
                "host"
              ],
              "default": "container-use"
            },
            "fallback": {
              "type": "string",
              "enum": [
                "docker",
                "container-use",
                "host"
              ]
            },
            "docker": {
              "type": "object",
              "properties": {
                "image": {
                  "type": "string",
                  "default": "node:20-alpine"
                },
                "network": {
                  "type": "string",
                  "enum": [
                    "none",
                    "bridge",
                    "host"
                  ]
                },
                "timeout": {
                  "type": "number",
                  "default": 300
                }
              },
              "additionalProperties": false
            },
            "containerUse": {
              "type": "object",
              "properties": {
                "image": {
                  "type": "string"
                },
                "envId": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "host": {
              "type": "object",
              "properties": {
                "timeout": {
                  "type": "number",
                  "default": 300
                },
                "warnOnStart": {
                  "type": "boolean",
                  "default": true
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "loop": {
          "type": "object",
          "properties": {
            "max_iterations": {
              "type": "number",
              "default": 100
            },
            "completion_promise": {
              "type": "string",
              "default": "LOOP_COMPLETE"
            },
            "idle_timeout_secs": {
              "type": "number",
              "default": 1800
            }
          },
          "additionalProperties": false
        },
        "hats": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "triggers": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "publishes": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "instructions": {
                "type": "string"
              }
            },
            "required": [
              "triggers",
              "publishes"
            ],
            "additionalProperties": false
          }
        },
        "gates": {
          "type": "object",
          "properties": {
            "after_plan": {
              "type": "boolean",
              "default": true
            },
            "after_implementation": {
              "type": "boolean",
              "default": false
            },
            "before_pr": {
              "type": "boolean",
              "default": true
            }
          },
          "additionalProperties": false
        },
        "quality": {
          "type": "object",
          "properties": {
            "min_score": {
              "type": "number",
              "default": 8
            },
            "auto_approve_above": {
              "type": "number",
              "default": 9
            }
          },
          "additionalProperties": false
        },
        "state": {
          "type": "object",
          "properties": {
            "use_github_labels": {
              "type": "boolean",
              "default": true
            },
            "use_scratchpad": {
              "type": "boolean",
              "default": true
            },
            "scratchpad_path": {
              "type": "string",
              "default": ".agent/scratchpad.md"
            }
          },
          "additionalProperties": false
        },
        "autoIssue": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "minPriority": {
              "type": "string",
              "enum": [
                "high",
                "medium",
                "low"
              ],
              "default": "medium"
            },
            "labels": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "auto-generated",
                "improvement"
              ]
            },
            "repository": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "required": [
        "backend",
        "loop"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}