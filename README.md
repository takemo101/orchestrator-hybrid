# Orchestrator Hybrid

GitHub Issueã‚’å…¥åŠ›ã¨ã—ã¦ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªå‹•çš„ã«ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‚

[Ralph Orchestrator](https://github.com/ralphscheid/ralph-orchestrator)ã®è‡ªå‹•ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œã¨ã€[Composer Workflow](https://github.com/example/composer-workflow)ã®GitHubçµ±åˆãƒ»æ‰¿èªã‚²ãƒ¼ãƒˆã‚’çµ„ã¿åˆã‚ã›ãŸè¨­è¨ˆã€‚

## ä½•ãŒã§ãã‚‹ã‹

```
GitHub Issue â†’ AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå‹•å®Ÿè¡Œ â†’ å®Œäº†æ¤œå‡º â†’ PRä½œæˆ
                    â†‘____åå¾©____â†“
```

1. **GitHub Issueã‚’èª­ã¿è¾¼ã¿**ã€ã‚¿ã‚¹ã‚¯å†…å®¹ã‚’AIã«æ¸¡ã™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ
2. **Claude/OpenCodeã‚’è‡ªå‹•å®Ÿè¡Œ**ã€å®Œäº†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆ`LOOP_COMPLETE`ï¼‰ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã¾ã§åå¾©
3. **Hatã‚·ã‚¹ãƒ†ãƒ **ã§å½¹å‰²ï¼ˆãƒ†ã‚¹ã‚¿ãƒ¼â†’å®Ÿè£…è€…â†’ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼‰ã‚’è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
4. **æ‰¿èªã‚²ãƒ¼ãƒˆ**ã§äººé–“ãŒãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šå¯èƒ½
5. **PRè‡ªå‹•ä½œæˆ**ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Œçµ

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- [Bun](https://bun.sh/) 1.0ä»¥ä¸Š
- `gh` (GitHub CLI) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»èªè¨¼æ¸ˆã¿
- `claude` ã¾ãŸã¯ `opencode` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
git clone https://github.com/takemo101/orchestrator-hybrid.git
cd orchestrator-hybrid
bun install
```

### ãƒã‚¤ãƒŠãƒªã¨ã—ã¦ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒã‚¤ãƒŠãƒªã‚’ãƒ“ãƒ«ãƒ‰
bun run build:binary

# å®Ÿè¡Œ
./orch run --issue 123 --auto
```

### æœ€ã‚‚ç°¡å˜ãªä½¿ã„æ–¹

```bash
# Issue #123 ã‚’è‡ªå‹•å®Ÿè¡Œï¼ˆæ‰¿èªã‚²ãƒ¼ãƒˆã‚ã‚Šï¼‰
bun run dev run --issue 123

# æ‰¿èªã‚²ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å®Œå…¨è‡ªå‹•å®Ÿè¡Œ
bun run dev run --issue 123 --auto

# å®Œäº†å¾Œã«PRã‚‚è‡ªå‹•ä½œæˆ
bun run dev run --issue 123 --auto --create-pr
```

---

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®åˆæœŸåŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§åˆæœŸåŒ–
bun run dev init

# ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰åˆæœŸåŒ–
bun run dev init --preset tdd

# åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§
bun run dev init --list-presets
```

ã“ã‚Œã«ã‚ˆã‚Š `orch.yml` ãŒä½œæˆã•ã‚Œã¾ã™ã€‚è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### 2. ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ

```bash
bun run dev run --issue <Issueç•ªå·> [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]
```

#### ä¸»è¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | çŸ­ç¸®å½¢ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|--------|------|-----------|
| `--issue <ç•ªå·>` | `-i` | **å¿…é ˆ** GitHub Issueç•ªå· | - |
| `--auto` | `-a` | æ‰¿èªã‚²ãƒ¼ãƒˆã‚’è‡ªå‹•æ‰¿èª | false |
| `--create-pr` | - | å®Œäº†å¾Œã«PRã‚’è‡ªå‹•ä½œæˆ | false |
| `--draft` | - | PRã‚’ãƒ‰ãƒ©ãƒ•ãƒˆã¨ã—ã¦ä½œæˆ | false |
| `--container` | - | éš”é›¢ã•ã‚ŒãŸcontainer-useç’°å¢ƒã§å®Ÿè¡Œ | false |
| `--report [ãƒ‘ã‚¹]` | - | å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ | .agent/report.md |
| `--preset <åå‰>` | `-p` | ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã‚’ä½¿ç”¨ | - |
| `--backend <ç¨®é¡>` | `-b` | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `claude` / `opencode` | claude |
| `--max-iterations <æ•°>` | `-m` | æœ€å¤§åå¾©å›æ•° | 100 |
| `--config <ãƒ‘ã‚¹>` | `-c` | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ | orch.yml |
| `--verbose` | `-v` | è©³ç´°ãƒ­ã‚°ã‚’å‡ºåŠ› | false |

#### å®Ÿè¡Œä¾‹

```bash
# åŸºæœ¬å®Ÿè¡Œï¼ˆæ‰¿èªã‚²ãƒ¼ãƒˆã§ä¸€æ™‚åœæ­¢ï¼‰
bun run dev run --issue 42

# å®Œå…¨è‡ªå‹•å®Ÿè¡Œï¼ˆäººé–“ã®ä»‹å…¥ãªã—ï¼‰
bun run dev run --issue 42 --auto

# TDDãƒ—ãƒªã‚»ãƒƒãƒˆã§å®Ÿè¡Œ
bun run dev run --issue 42 --preset tdd --auto

# OpenCodeãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®Ÿè¡Œ
bun run dev run --issue 42 --backend opencode --auto

# æœ€å¤§30å›ã®åå¾©ã§å®Ÿè¡Œ
bun run dev run --issue 42 --max-iterations 30 --auto

# å®Œäº†å¾Œã«ãƒ‰ãƒ©ãƒ•ãƒˆPRã‚’ä½œæˆ
bun run dev run --issue 42 --auto --create-pr --draft

# container-useç’°å¢ƒã§éš”é›¢å®Ÿè¡Œ
bun run dev run --issue 42 --auto --container

# å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
bun run dev run --issue 42 --auto --report

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹ã«ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
bun run dev run --issue 42 --auto --report ./reports/issue-42.md
```

### 3. çŠ¶æ…‹ã®ç¢ºèª

```bash
# Issue #42 ã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¡¨ç¤º
bun run dev status --issue 42

# ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´ã‚’è¡¨ç¤º
bun run dev events
```

---

## ä¸¦åˆ—ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ

è¤‡æ•°ã®Issueã‚’åŒæ™‚ã«å®Ÿè¡Œã—ã€çŠ¶æ…‹ã‚’ç›£è¦–ã§ãã¾ã™ã€‚

### è¤‡æ•°Issueã®ä¸¦åˆ—å®Ÿè¡Œ

```bash
# è¤‡æ•°Issueã‚’åŒæ™‚å®Ÿè¡Œ
bun run dev run --issues 42,43,44 --auto

# ãƒã‚¤ãƒŠãƒªã®å ´åˆ
./orch run --issues 42,43,44 --auto
```

### ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®ç¢ºèª

```bash
# å…¨ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã‚’è¡¨ç¤º
bun run dev status --all

# ç‰¹å®šã‚¿ã‚¹ã‚¯ã®è©³ç´°ã‚’è¡¨ç¤º
bun run dev status --task <task-id>
```

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

```bash
# ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ï¼ˆ1ç§’é–“éš”ã§æ›´æ–°ï¼‰
bun run dev logs --table

# ç‰¹å®šã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ï¼ˆv1.2.0+ï¼‰
bun run dev logs --task <task-id> --follow

# æœ€å¾Œã®50è¡Œã‚’è¡¨ç¤º
bun run dev logs --task <task-id> --lines 50
```

#### logsã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆv1.2.0+ï¼‰

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | çŸ­ç¸®å½¢ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|--------|------|-----------|
| `--task <id>` | `-t` | ç‰¹å®šã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‚’è¡¨ç¤º | - |
| `--follow` | `-f` | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° | false |
| `--lines <num>` | `-n` | è¡¨ç¤ºã™ã‚‹è¡Œæ•° | 100 |
| `--table` | - | ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤ºï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰ | false |
| `--interval <ms>` | - | ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®æ›´æ–°é–“éš” | 1000 |

### ã‚¿ã‚¹ã‚¯ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«

```bash
# ç‰¹å®šã‚¿ã‚¹ã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
bun run dev cancel --task <task-id>

# å…¨ã‚¿ã‚¹ã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
bun run dev cancel --all
```

### ã‚¿ã‚¹ã‚¯å±¥æ­´ã®ã‚¯ãƒªã‚¢

```bash
# å®Œäº†ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã‚’ã‚¯ãƒªã‚¢
bun run dev clear --force
```

---

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

### åŸºæœ¬ãƒ•ãƒ­ãƒ¼ï¼ˆHatãªã— / `simple`ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰

```
é–‹å§‹
  â”‚
  â”œâ”€â–¶ GitHub Issueã‚’å–å¾—
  â”‚
  â”œâ”€â–¶ PROMPT.md ã‚’ç”Ÿæˆï¼ˆ.agent/PROMPT.mdï¼‰
  â”‚
  â”œâ”€â–¶ Scratchpad ã‚’åˆæœŸåŒ–ï¼ˆ.agent/scratchpad.mdï¼‰
  â”‚
  â”œâ”€â–¶ [æ‰¿èªã‚²ãƒ¼ãƒˆ] Pre-Loop: å®Ÿè¡Œå‰ç¢ºèª
  â”‚
  â”œâ”€â–¶ ãƒ«ãƒ¼ãƒ—é–‹å§‹
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ å‡ºåŠ›ã« "LOOP_COMPLETE" ãŒã‚ã‚‹ã‹ç¢ºèª
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€ ãªã— â†’ ãƒ«ãƒ¼ãƒ—ç¶™ç¶š
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€ ã‚ã‚Š â†’ ãƒ«ãƒ¼ãƒ—çµ‚äº†
  â”‚     â”‚
  â”‚     â””â”€â–¶ ï¼ˆæœ€å¤§åå¾©å›æ•°ã«é”ã—ãŸã‚‰å¼·åˆ¶çµ‚äº†ï¼‰
  â”‚
  â”œâ”€â–¶ [æ‰¿èªã‚²ãƒ¼ãƒˆ] Post-Completion: å®Œäº†ç¢ºèª
  â”‚
  â””â”€â–¶ ï¼ˆ--create-præŒ‡å®šæ™‚ï¼‰PRè‡ªå‹•ä½œæˆ
```

### Hatãƒ•ãƒ­ãƒ¼ï¼ˆ`tdd`ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰

```
é–‹å§‹
  â”‚
  â”œâ”€â–¶ task.start ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
  â”‚
  â”œâ”€â–¶ ğŸ§ª Tester Hat
  â”‚     â””â”€â–¶ ãƒ†ã‚¹ãƒˆã‚’æ›¸ã â†’ EVENT: tests.failing
  â”‚
  â”œâ”€â–¶ ğŸ”¨ Implementer Hat
  â”‚     â””â”€â–¶ ãƒ†ã‚¹ãƒˆã‚’é€šã™å®Ÿè£… â†’ EVENT: code.written
  â”‚
  â”œâ”€â–¶ ğŸ§ª Tester Hat
  â”‚     â””â”€â–¶ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ EVENT: tests.passing
  â”‚
  â”œâ”€â–¶ âœ¨ Refactorer Hat
  â”‚     â””â”€â–¶ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° â†’ EVENT: LOOP_COMPLETE
  â”‚
  â””â”€â–¶ å®Œäº†
```

---

## ãƒ—ãƒªã‚»ãƒƒãƒˆ

### `simple` - ã‚·ãƒ³ãƒ—ãƒ«ãƒ«ãƒ¼ãƒ—

Hatãªã—ã®å˜ç´”ãªãƒ«ãƒ¼ãƒ—ã€‚AIãŒ `LOOP_COMPLETE` ã‚’å‡ºåŠ›ã™ã‚‹ã¾ã§åå¾©ã€‚

```bash
bun run dev run --issue 42 --preset simple
```

### `tdd` - ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º

Red â†’ Green â†’ Refactor ã®TDDã‚µã‚¤ã‚¯ãƒ«ã‚’å¼·åˆ¶ã€‚

| Hat | ãƒˆãƒªã‚¬ãƒ¼ | å‡ºåŠ›ã‚¤ãƒ™ãƒ³ãƒˆ |
|-----|---------|-------------|
| ğŸ§ª Tester | `task.start`, `code.written` | `tests.failing`, `tests.passing` |
| ğŸ”¨ Implementer | `tests.failing` | `code.written` |
| âœ¨ Refactorer | `tests.passing` | `code.written`, `LOOP_COMPLETE` |

```bash
bun run dev run --issue 42 --preset tdd
```

### `spec-driven` - ä»•æ§˜é§†å‹•é–‹ç™º

è¨ˆç”» â†’ å®Ÿè£… â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼ ã®ã‚µã‚¤ã‚¯ãƒ«ã€‚è¨ˆç”»å¾Œã«æ‰¿èªã‚²ãƒ¼ãƒˆã‚ã‚Šã€‚

| Hat | ãƒˆãƒªã‚¬ãƒ¼ | å‡ºåŠ›ã‚¤ãƒ™ãƒ³ãƒˆ |
|-----|---------|-------------|
| ğŸ“‹ Planner | `task.start` | `plan.ready` |
| ğŸ”¨ Builder | `plan.ready`, `review.revise` | `build.done` |
| ğŸ” Reviewer | `build.done` | `review.approved`, `review.revise`, `LOOP_COMPLETE` |

```bash
bun run dev run --issue 42 --preset spec-driven
```

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

`orch.yml` ã§è©³ç´°ãªè¨­å®šãŒå¯èƒ½ã§ã™ã€‚

```yaml
version: "1.0"

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š
backend:
  type: claude                    # claude | opencode | container
  model: claude-sonnet-4-20250514 # ã‚ªãƒ—ã‚·ãƒ§ãƒ³

# container-useè¨­å®šï¼ˆéš”é›¢ç’°å¢ƒï¼‰
container:
  enabled: false                  # trueã§å¸¸ã«containerç’°å¢ƒã‚’ä½¿ç”¨
  image: node:20                  # ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸
  env_id: ""                      # æ—¢å­˜ã®ç’°å¢ƒIDã‚’å†åˆ©ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒè¨­å®šï¼ˆv1.2.0+ï¼‰
sandbox:
  type: docker                    # docker | container-use | host
  fallback: host                  # ãƒ—ãƒ©ã‚¤ãƒãƒªç’°å¢ƒãŒä½¿ãˆãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  docker:
    image: node:20-alpine         # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸
    network: none                 # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šï¼ˆnone = éš”é›¢ï¼‰
    timeout: 300                  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
  containerUse:
    image: node:20                # container-useç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸
    envId: ""                     # æ—¢å­˜ç’°å¢ƒIDï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  host:
    warnOnStart: true             # ãƒ›ã‚¹ãƒˆç’°å¢ƒä½¿ç”¨æ™‚ã«è­¦å‘Š

# ãƒ«ãƒ¼ãƒ—è¨­å®š
loop:
  max_iterations: 100             # æœ€å¤§åå¾©å›æ•°
  completion_promise: "LOOP_COMPLETE"  # å®Œäº†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  idle_timeout_secs: 1800         # ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰

# æ‰¿èªã‚²ãƒ¼ãƒˆ
gates:
  after_plan: true                # è¨ˆç”»å¾Œã«æ‰¿èªã‚’è¦æ±‚
  after_implementation: false     # å®Ÿè£…å¾Œã¯è‡ªå‹•ç¶šè¡Œ
  before_pr: true                 # PRä½œæˆå‰ã«æ‰¿èªã‚’è¦æ±‚

# å“è³ªåŸºæº–ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
quality:
  min_score: 8                    # æœ€ä½å“è³ªã‚¹ã‚³ã‚¢
  auto_approve_above: 9           # ã“ã®ã‚¹ã‚³ã‚¢ä»¥ä¸Šã§è‡ªå‹•æ‰¿èª

# çŠ¶æ…‹ç®¡ç†
state:
  use_github_labels: true         # GitHub Issueãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨
  use_scratchpad: true            # Scratchpadã‚’ä½¿ç”¨
  scratchpad_path: ".agent/scratchpad.md"

# æ”¹å–„Issueè‡ªå‹•ä½œæˆï¼ˆv1.2.0+ï¼‰
autoIssue:
  enabled: true                   # æ”¹å–„Issueè‡ªå‹•ä½œæˆã‚’æœ‰åŠ¹åŒ–
  minPriority: medium             # æœ€ä½å„ªå…ˆåº¦ï¼ˆhigh | medium | lowï¼‰
  labels:                         # è‡ªå‹•ä»˜ä¸ã™ã‚‹ãƒ©ãƒ™ãƒ«
    - auto-generated
    - improvement
  duplicateCheckEnabled: true     # é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–
  repository: ""                  # åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã«ä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# ã‚«ã‚¹ã‚¿ãƒ Hatå®šç¾©
hats:
  my_custom_hat:
    name: "ğŸ¯ My Hat"
    triggers: ["some.event"]
    publishes: ["another.event", "LOOP_COMPLETE"]
    instructions: |
      ã‚«ã‚¹ã‚¿ãƒ ã®æŒ‡ç¤ºã‚’ã“ã“ã«æ›¸ã
```

---

## ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

å®Ÿè¡Œæ™‚ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `.agent/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `.agent/PROMPT.md` | AIã«æ¸¡ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ |
| `.agent/scratchpad.md` | AIãŒä½¿ç”¨ã™ã‚‹ãƒ¡ãƒ¢å¸³ï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰ |
| `.agent/events.jsonl` | ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´ï¼ˆHatåˆ‡ã‚Šæ›¿ãˆç­‰ï¼‰ |
| `.agent/output_history.txt` | å‡ºåŠ›å±¥æ­´ï¼ˆãƒ«ãƒ¼ãƒ—æ¤œå‡ºç”¨ï¼‰ |
| `.agent/report.md` | å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆï¼ˆ`--report`æŒ‡å®šæ™‚ï¼‰ |
| `.agent/report.json` | å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆï¼ˆJSONå½¢å¼ï¼‰ |

---

## å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆ

`--report` ãƒ•ãƒ©ã‚°ã§å®Ÿè¡Œçµæœã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

### ä½¿ç”¨æ–¹æ³•

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ï¼ˆ.agent/report.mdï¼‰ã«ç”Ÿæˆ
bun run dev run --issue 42 --auto --report

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹ã«ç”Ÿæˆ
bun run dev run --issue 42 --auto --report ./reports/issue-42.md
```

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¢å¼ | èª¬æ˜ |
|---------|------|------|
| `report.md` | Markdown | äººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼ |
| `report.json` | JSON | ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‡¦ç†ã—ã‚„ã™ã„å½¢å¼ |

### ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹

- **ã‚µãƒãƒªãƒ¼**: Issueæƒ…å ±ã€æˆåŠŸ/å¤±æ•—ã€æ‰€è¦æ™‚é–“ã€åå¾©å›æ•°
- **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**: å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®Hatã€æ‰€è¦æ™‚é–“ã€çµ‚äº†ã‚³ãƒ¼ãƒ‰ã€ç™ºè¡Œã‚¤ãƒ™ãƒ³ãƒˆ
- **ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´**: Haté–“ã§ç™ºè¡Œã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã®æ™‚ç³»åˆ—
- **PRæƒ…å ±**: ä½œæˆã•ã‚ŒãŸPRã®URLã€ç•ªå·ã€ãƒ–ãƒ©ãƒ³ãƒ
- **è¨­å®š**: ä½¿ç”¨ã•ã‚ŒãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€æœ€å¤§åå¾©æ•°ã€å®Œäº†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰

### ãƒ¬ãƒãƒ¼ãƒˆä¾‹

```markdown
# Orchestration Report

## Summary

| Metric | Value |
|--------|-------|
| Issue | #42: Add user authentication |
| Status | âœ… Completed |
| Duration | 5m 30s |
| Iterations | 8 |

## Timeline

| # | Hat | Duration | Exit | Event |
|---|-----|----------|------|-------|
| 1 | Tester | 45000ms | âœ“ | tests.failing |
| 2 | Implementer | 120000ms | âœ“ | code.written |
| 3 | Tester | 30000ms | âœ“ | tests.passing |
| 4 | Refactorer | 60000ms | âœ“ | LOOP_COMPLETE |
```

---

## Container-Use ãƒ¢ãƒ¼ãƒ‰ï¼ˆéš”é›¢ç’°å¢ƒï¼‰

`--container` ãƒ•ãƒ©ã‚°ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ container-use ç’°å¢ƒã§ã®å®Ÿè¡ŒãŒå¯èƒ½ã§ã™ã€‚

### ç‰¹å¾´

- **éš”é›¢å®Ÿè¡Œ**: ãƒ›ã‚¹ãƒˆç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆãªã„å®‰å…¨ãªå®Ÿè¡Œ
- **å†ç¾æ€§**: åŒã˜ç’°å¢ƒã§ç¹°ã‚Šè¿”ã—å®Ÿè¡Œå¯èƒ½
- **ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹**: æ¯å›ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã‹ã‚‰é–‹å§‹

### ä½¿ç”¨æ–¹æ³•

```bash
# CLIãƒ•ãƒ©ã‚°ã§æœ‰åŠ¹åŒ–
bun run dev run --issue 42 --auto --container

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å¸¸ã«æœ‰åŠ¹åŒ–
# orch.yml ã«ä»¥ä¸‹ã‚’è¿½åŠ :
container:
  enabled: true
  image: node:20
```

### å‰ææ¡ä»¶

- `cu` (container-use CLI) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- Docker ãŒå®Ÿè¡Œä¸­

### æ³¨æ„äº‹é …

- container-use ç’°å¢ƒã¯ãƒ«ãƒ¼ãƒ—å®Œäº†å¾Œã‚‚ä¿æŒã•ã‚Œã¾ã™
- æ˜ç¤ºçš„ã«å‰Šé™¤ã™ã‚‹ã¾ã§ç’°å¢ƒã¯æ®‹ã‚Šã¾ã™
- æ—¢å­˜ã®ç’°å¢ƒã‚’å†åˆ©ç”¨ã™ã‚‹ã«ã¯ `container.env_id` ã‚’è¨­å®š

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### "LOOP_COMPLETE" ãŒå‡ºåŠ›ã•ã‚Œãªã„

AIãŒå®Œäº†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ãªã„ã¨ã€æœ€å¤§åå¾©å›æ•°ã«é”ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ãŒç¶šãã¾ã™ã€‚

**å¯¾å‡¦æ³•:**
- `--max-iterations` ã§åå¾©å›æ•°ã‚’åˆ¶é™
- Issueã®èª¬æ˜ã‚’æ˜ç¢ºã«ã™ã‚‹
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ`.agent/PROMPT.md`ï¼‰ã‚’ç¢ºèªãƒ»èª¿æ•´

### æ‰¿èªã‚²ãƒ¼ãƒˆã§ã‚¹ã‚¿ãƒƒã‚¯ã™ã‚‹

`--auto` ãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã‚‹ã¨æ‰¿èªã‚²ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ãã¾ã™ã€‚

```bash
bun run dev run --issue 42 --auto
```

### GitHubèªè¨¼ã‚¨ãƒ©ãƒ¼

```bash
# GitHub CLIã®èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
gh auth status

# å†èªè¨¼
gh auth login
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
# Claudeã®å ´åˆ
which claude

# OpenCodeã®å ´åˆ
which opencode
```

---

## é–‹ç™º

### Justfileï¼ˆæ¨å¥¨ï¼‰

[just](https://github.com/casey/just) ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ã‚’ç°¡æ½”ã«å®Ÿè¡Œã§ãã¾ã™ã€‚

```bash
# justã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSï¼‰
brew install just

# ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º
just

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆä¾å­˜é–¢ä¿‚ + ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆï¼‰
just setup

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
just test

# å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆlint + format + typecheckï¼‰
just check

# ãƒã‚¤ãƒŠãƒªãƒ“ãƒ«ãƒ‰
just build

# ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰
just build-all
```

#### åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `just setup` | ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆ |
| `just dev [args]` | é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§CLIå®Ÿè¡Œ |
| `just test` | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `just test-watch` | ãƒ†ã‚¹ãƒˆã‚’watchãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ |
| `just check` | lint + format + typecheck |
| `just build` | ç¾åœ¨ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ãƒã‚¤ãƒŠãƒª |
| `just build-all` | å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ |
| `just clean` | ãƒ“ãƒ«ãƒ‰æˆæœç‰©å‰Šé™¤ |
| `just ci` | CIç”¨ãƒã‚§ãƒƒã‚¯ï¼ˆtest + checkï¼‰ |

### npm scripts

```bash
# JavaScriptã«ãƒ“ãƒ«ãƒ‰
bun run build

# ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒŠãƒªã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆæ¨å¥¨ï¼‰
bun run build:binary

# ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰
bun run build:binary:linux    # Linux x64
bun run build:binary:macos    # macOS ARM64
bun run build:binary:windows  # Windows x64
```

### ãƒ†ã‚¹ãƒˆ

```bash
bun test
# ã¾ãŸã¯
just test
```

### å‹ãƒã‚§ãƒƒã‚¯

```bash
bun run typecheck
# ã¾ãŸã¯
just typecheck
```

### Lint & Format

```bash
bun run lint
bun run format
# ã¾ãŸã¯
just check
```

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒã‚¤ãƒŠãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ‘ã‚¹ã®é€šã£ãŸå ´æ‰€ã«é…ç½®
just build
sudo mv orch /usr/local/bin/

# ã“ã‚Œã§ `orch` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
orch run --issue 42
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
src/
â”œâ”€â”€ cli.ts              # CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ cli-logs.ts         # logsã‚³ãƒãƒ³ãƒ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆv1.2.0+ï¼‰
â”œâ”€â”€ index.ts            # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ loop.ts         # ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ event.ts        # ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ï¼ˆHaté–“é€šä¿¡ï¼‰
â”‚   â”œâ”€â”€ hat.ts          # Hatã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ config.ts       # è¨­å®šèª­ã¿è¾¼ã¿
â”‚   â”œâ”€â”€ scratchpad.ts   # Scratchpadç®¡ç†
â”‚   â”œâ”€â”€ logger.ts       # ãƒ­ã‚¬ãƒ¼
â”‚   â”œâ”€â”€ task-manager.ts # ä¸¦åˆ—ã‚¿ã‚¹ã‚¯ç®¡ç†
â”‚   â”œâ”€â”€ exec.ts         # Bun.spawn ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ errors.ts       # ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹éšå±¤ï¼ˆv1.2.0+ï¼‰
â”‚   â”œâ”€â”€ log-writer.ts   # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ï¼ˆv1.2.0+ï¼‰
â”‚   â”œâ”€â”€ log-streamer.ts # ãƒ­ã‚°ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª­ã¿å–ã‚Šï¼ˆv1.2.0+ï¼‰
â”‚   â”œâ”€â”€ bun-process-executor.ts  # ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡ŒæŠ½è±¡åŒ–ï¼ˆv1.2.0+ï¼‰
â”‚   â””â”€â”€ types.ts        # å‹å®šç¾©
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ base.ts         # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ½è±¡åŸºåº•
â”‚   â”œâ”€â”€ claude.ts       # Claude Code ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
â”‚   â”œâ”€â”€ opencode.ts     # OpenCode ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
â”‚   â”œâ”€â”€ container.ts    # Container-use ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ï¼‰
â”‚   â”œâ”€â”€ docker-adapter.ts     # Docker sandboxï¼ˆv1.2.0+ï¼‰
â”‚   â”œâ”€â”€ host-adapter.ts       # ãƒ›ã‚¹ãƒˆç’°å¢ƒ sandboxï¼ˆv1.2.0+ï¼‰
â”‚   â”œâ”€â”€ sandbox-adapter.ts    # SandboxæŠ½è±¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆv1.2.0+ï¼‰
â”‚   â””â”€â”€ sandbox-factory.ts    # Sandboxãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼ˆv1.2.0+ï¼‰
â”œâ”€â”€ input/
â”‚   â”œâ”€â”€ github.ts       # GitHub Issueå–å¾—
â”‚   â””â”€â”€ prompt.ts       # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”œâ”€â”€ gates/
â”‚   â””â”€â”€ approval.ts     # æ‰¿èªã‚²ãƒ¼ãƒˆ
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ pr.ts           # PRä½œæˆ
â”‚   â”œâ”€â”€ report.ts       # å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”‚   â””â”€â”€ issue-generator.ts    # æ”¹å–„Issueè‡ªå‹•ä½œæˆï¼ˆv1.2.0+ï¼‰
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ improvement-extractor.ts  # æ”¹å–„ç‚¹æŠ½å‡ºï¼ˆv1.2.0+ï¼‰
â””â”€â”€ schemas/
    â””â”€â”€ orch.schema.json  # JSON Schemaï¼ˆè‡ªå‹•ç”Ÿæˆã€v1.2.0+ï¼‰
```

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT
